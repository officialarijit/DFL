version: "3"

services:

  server:
    image: arijitnandi/fedserver
    ports: 
      - 80:80
    env_file:
      - ./config.env
    links:
      - emqx
    depends_on: 
      - emqx
    volumes:
      - /home/ubuntu/fedserver-data/data:/home/data
      - /home/ubuntu/fedserver-data/global_model:/home/global_model
      - /home/ubuntu/fedserver-data/local_model:/home/local_model
  
  emqx: 
    image: emqx/emqx:latest
    environment: 
      - "EMQX_NAME=emqx"
      - "EMQX_HOST=node.emqx.io"
      - "EMQX_CLUSTER__DISCOVERY_STRATEGY=static"
      - "EMQX_CLUSTER__STATIC__SEEDS=[emqx@node.emqx.io]"

    networks:
        emqx-bridge:
           aliases: node.emqx.io

    volumes:
      - /home/ubuntu/emqx/data:/opt/emqx/data
      - /home/ubuntu/emqx/log:/opt/emqx/log
    restart: always

networks:
  emqx-bridge:
      driver: bridge
